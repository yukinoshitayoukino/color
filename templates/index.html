<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä —Ü–≤–µ—Ç–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ —Å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞–º–∏</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .header {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 5px solid #3498db;
            border-right: 5px solid #3498db;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
        }

        .left-panel, .right-panel {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        h2 {
            color: #34495e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #f0f0f0;
            font-size: 1.5em;
        }

        h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .section {
            margin-bottom: 30px;
        }

        .upload-form {
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ddd;
            transition: all 0.3s ease;
        }

        .upload-form:hover {
            border-color: #3498db;
            background-color: #e8f4fc;
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .image-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            background: white;
        }

        .image-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .image-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }

        .image-name {
            padding: 10px;
            background-color: white;
            font-size: 14px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
        }

        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .image-item:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background-color: #c0392b;
            transform: scale(1.1);
        }

        /* –°–ª–∞–π–¥–µ—Ä—ã */
        .sliders-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .slider-group {
            margin-bottom: 20px;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .slider-label {
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 16px;
        }

        .slider-value {
            background: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            min-width: 60px;
            text-align: center;
        }

        input[type="range"] {
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }

        #red-slider::-webkit-slider-thumb {
            background: #e74c3c;
        }

        #green-slider::-webkit-slider-thumb {
            background: #2ecc71;
        }

        #blue-slider::-webkit-slider-thumb {
            background: #3498db;
        }

        /* –ë–ª–æ–∫ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ */
        .watermark-container {
            background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #bbdefb;
        }

        .watermark-options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .watermark-option {
            flex: 1;
            min-width: 200px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .watermark-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .watermark-option.active {
            border-color: #2196f3;
            background: #e3f2fd;
        }

        .watermark-option h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .watermark-icon {
            font-size: 40px;
            margin-bottom: 10px;
            color: #2196f3;
        }

        .watermark-controls {
            margin-top: 20px;
            display: none;
        }

        .watermark-controls.active {
            display: block;
        }

        .watermark-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #bbdefb;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .watermark-input:focus {
            outline: none;
            border-color: #2196f3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .watermark-image-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .watermark-image-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .watermark-image-item:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .watermark-image-item.active {
            border-color: #2196f3;
        }

        .watermark-image-item img {
            width: 100%;
            height: 80px;
            object-fit: cover;
        }

        .watermark-slider-group {
            margin-top: 15px;
        }

        .watermark-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #2196f3;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä */
        .preview-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        .preview-container {
            text-align: center;
            margin: 20px 0;
        }

        .preview-image {
            max-width: 100%;
            max-height: 250px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        /* –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ */
        .histogram-container {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .histogram-image {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-top: 5px;
            color: #fff;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .preview-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .preview-btn:hover {
            background: linear-gradient(135deg, #2980b9 0%, #1f6396 100%);
        }

        .save-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }

        .save-btn:hover {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
        }

        .watermark-save-btn {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
        }

        .watermark-save-btn:hover {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
        }

        .upload-btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            border: none;
            transition: all 0.3s ease;
            width: 100%;
            font-weight: bold;
        }

        .upload-btn:hover {
            background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        input[type="file"] {
            margin: 15px 0;
            padding: 15px;
            border: 2px dashed #3498db;
            border-radius: 8px;
            width: 100%;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="file"]:hover {
            background: #e8f4fc;
            border-color: #2980b9;
        }

        .empty-message {
            text-align: center;
            color: #7f8c8d;
            padding: 40px;
            font-style: italic;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ddd;
        }

        /* –í–∫–ª–∞–¥–∫–∏ */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #7f8c8d;
        }

        .tab:hover {
            background: #e9ecef;
            color: #3498db;
        }

        .tab.active {
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }

            .image-gallery {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .buttons {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .watermark-options {
                flex-direction: column;
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ */
        .watermark-hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .watermark-badge {
            background-color: #2196f3;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            position: absolute;
            top: 5px;
            left: 5px;
        }
    </style>
</head>
<body>
   <div class="container">
        <div class="header fade-in">
            <h1>–õ–ê–ë–û–†–ê–¢–û–†–ù–ê–Ø –†–ê–ë–û–¢–ê ‚Ññ 1 ¬´–†–ê–ó–†–ê–ë–û–¢–ö–ê –í–ï–ë-–ü–†–ò–õ–û–ñ–ï–ù–ò–Ø –ù–ê PYTHON¬ª </h1>
            <div class="subtitle">–í–∞—Ä–∏–∞–Ω—Ç 9: –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ª—é–±–æ–π —Ü–≤–µ—Ç–æ–≤–æ–π –∫–∞—Ä—Ç—ã
–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö, –≤—ã–¥–∞–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤
–∏—Å—Ö–æ–¥–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏.  </div>
        </div>

        <div class="main-content">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="left-panel fade-in">
                <div class="section">
                    <h2>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h2>
                    <form action="/upload" method="post" enctype="multipart/form-data" class="upload-form">
                        <input type="file" name="files" multiple accept="image/*" required>
                        <input type="hidden" name="upload_type" value="images">
                        <button type="submit" class="upload-btn">
                            üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                        </button>
                    </form>
                </div>

                <div class="section">
                    <h2>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤</h2>
                    <form action="/upload" method="post" enctype="multipart/form-data" class="upload-form">
                        <input type="file" name="files" multiple accept="image/*" required>
                        <input type="hidden" name="upload_type" value="watermarks">
                        <button type="submit" class="upload-btn">
                            üè∑Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤
                        </button>
                        <p class="watermark-hint">
                            –°–æ–≤–µ—Ç: –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –ª–æ–≥–æ—Ç–∏–ø—ã –∏–ª–∏ PNG —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é
                        </p>
                    </form>
                </div>

                <div class="section">
                    <h2>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2>
                    {% if images %}
                    <div class="image-gallery">
                        {% for image in images %}
                        <div class="image-item" onclick="selectImage('{{ image.name }}', '{{ image.url }}')">
                            <img src="{{ image.url }}" alt="{{ image.name }}" loading="lazy">
                            <div class="image-name">{{ image.name }}</div>
                            <a href="/delete/uploads/{{ image.name }}" class="delete-btn"
                               onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?'); event.stopPropagation();">√ó</a>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-message">
                        –ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    </div>
                    {% endif %}
                </div>

                <div class="section">
                    <h2>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏</h2>
                    {% if watermark_images %}
                    <div class="image-gallery">
                        {% for image in watermark_images %}
                        <div class="image-item watermark-image-selector"
                             onclick="selectWatermarkImage('{{ image.name }}', '{{ image.url }}')">
                            <div class="watermark-badge">–í–ó</div>
                            <img src="{{ image.url }}" alt="{{ image.name }}" loading="lazy">
                            <div class="image-name">{{ image.name }}</div>
                            <a href="/delete/watermarks/{{ image.name }}" class="delete-btn"
                               onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫?'); event.stopPropagation();">√ó</a>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-message">
                        –ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤<br>
                        <small>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –ª–æ–≥–æ—Ç–∏–ø—ã –≤—ã—à–µ</small>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="right-panel fade-in">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('editor')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä</div>
                    <div class="tab" onclick="switchTab('results')">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
                <div id="editor-tab" class="tab-content active">
                    <div id="editor" style="display: none;">
                        <div class="section">
                            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤</h2>
                            <div class="sliders-container">
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <div class="slider-label" style="color: #e74c3c;">
                                            üî¥ –ö—Ä–∞—Å–Ω—ã–π –∫–∞–Ω–∞–ª
                                        </div>
                                        <div class="slider-value" id="red-value">1.0</div>
                                    </div>
                                    <input type="range" class="red-slider" id="red-slider"
                                           min="0" max="3" step="0.1" value="1.0">
                                </div>

                                <div class="slider-group">
                                    <div class="slider-header">
                                        <div class="slider-label" style="color: #2ecc71;">
                                            üü¢ –ó–µ–ª–µ–Ω—ã–π –∫–∞–Ω–∞–ª
                                        </div>
                                        <div class="slider-value" id="green-value">1.0</div>
                                    </div>
                                    <input type="range" class="green-slider" id="green-slider"
                                           min="0" max="3" step="0.1" value="1.0">
                                </div>

                                <div class="slider-group">
                                    <div class="slider-header">
                                        <div class="slider-label" style="color: #3498db;">
                                            üîµ –°–∏–Ω–∏–π –∫–∞–Ω–∞–ª
                                        </div>
                                        <div class="slider-value" id="blue-value">1.0</div>
                                    </div>
                                    <input type="range" class="blue-slider" id="blue-slider"
                                           min="0" max="3" step="0.1" value="1.0">
                                </div>
                            </div>
                        </div>

                        <!-- –ë–ª–æ–∫ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ -->
                        <div class="section">
                            <h2>–í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫</h2>
                            <div class="watermark-container">
                                <div class="watermark-toggle">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="watermark-toggle">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span style="font-weight: bold; color: #1976d2;">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫</span>
                                </div>

                                <div id="watermark-controls" style="display: none;">
                                    <div class="watermark-options">
                                        <div class="watermark-option active" onclick="selectWatermarkType('text')">
                                            <div class="watermark-icon">‚úèÔ∏è</div>
                                            <h4>–¢–µ–∫—Å—Ç–æ–≤—ã–π</h4>
                                            <p>–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É</p>
                                        </div>
                                        <div class="watermark-option" onclick="selectWatermarkType('image')">
                                            <div class="watermark-icon">üñºÔ∏è</div>
                                            <h4>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h4>
                                            <p>–ù–∞–ª–æ–∂–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É</p>
                                        </div>
                                    </div>

                                    <!-- –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ -->
                                    <div id="text-watermark-controls" class="watermark-controls active">
                                        <input type="text" id="watermark-text" class="watermark-input"
                                               placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞" value="Watermark">
                                    </div>

                                    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ-–≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ -->
                                    <div id="image-watermark-controls" class="watermark-controls">
                                        {% if watermark_images %}
                                        <div class="watermark-image-list">
                                            {% for image in watermark_images %}
                                            <div class="watermark-image-item"
                                                 onclick="selectWatermarkImage('{{ image.name }}', '{{ image.url }}')">
                                                <img src="{{ image.url }}" alt="{{ image.name }}">
                                            </div>
                                            {% endfor %}
                                        </div>
                                        <p style="text-align: center; color: #666; font-size: 14px;">
                                            –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ
                                        </p>
                                        {% else %}
                                        <div class="empty-message" style="padding: 20px;">
                                            –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="preview-section">
                            <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π</h3>
                            <div class="preview-container">
                                <img id="preview-image" class="preview-image" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
                            </div>
                        </div>

                        <div class="histogram-container">
                            <h3>üìà –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤</h3>
                            <img id="preview-histogram" class="histogram-image"
                                 alt="–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞" style="display: none;">
                            <div id="histogram-placeholder" class="empty-message">
                                –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä"
                            </div>
                        </div>

                        <div id="stats-preview" class="stats-container" style="display: none;">
                            <h3 style="color: white; margin-top: 0;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–Ω–∞–ª–æ–≤</h3>
                            <div id="stats-content"></div>
                        </div>

                        <div class="buttons">
                            <button type="button" class="preview-btn" onclick="updatePreview()">
                                üîÑ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                            </button>
                            <button type="button" class="save-btn" onclick="saveModified()">
                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–µ–∑ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
                            </button>
                            <button type="button" class="watermark-save-btn" onclick="saveWithWatermark()">
                                üñºÔ∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º
                            </button>
                        </div>

                        <input type="hidden" id="selected-image">
                        <input type="hidden" id="selected-watermark-image">
                    </div>

                    <div id="no-selection" style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üñºÔ∏è</div>
                        <p style="color: #7f8c8d; font-size: 18px; font-weight: 500;">
                            –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                        </p>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
                <div id="results-tab" class="tab-content">
                    <div class="section">
                        <h2>üíæ –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2>
                        {% if modified_images %}
                        <div class="image-gallery">
                            {% for image in modified_images %}
                            <div class="image-item">
                                <img src="{{ image.url }}" alt="{{ image.name }}" loading="lazy">
                                <div class="image-name">{{ image.name }}</div>
                                <a href="/delete/modified/{{ image.name }}" class="delete-btn"
                                   onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')">√ó</a>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-message">
                            –ù–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                        </div>
                        {% endif %}
                    </div>

                    <div class="section">
                        <h2>–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã</h2>
                        {% if histogram_images %}
                        <div class="image-gallery">
                            {% for image in histogram_images %}
                            <div class="image-item">
                                <img src="{{ image.url }}" alt="{{ image.name }}" loading="lazy">
                                <div class="image-name">{{ image.name }}</div>
                                <a href="/delete/histograms/{{ image.name }}" class="delete-btn"
                                   onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É?')">√ó</a>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-message">
                            –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedImage = '';
        let selectedImageUrl = '';
        let selectedWatermarkImage = '';
        let selectedWatermarkType = 'text';

        function selectImage(imageName, imageUrl) {
            selectedImage = imageName;
            selectedImageUrl = imageUrl;

            document.getElementById('editor').style.display = 'block';
            document.getElementById('no-selection').style.display = 'none';
            document.getElementById('selected-image').value = imageName;
            document.getElementById('preview-image').src = imageUrl;

            // –°–±—Ä–æ—Å —Å–ª–∞–π–¥–µ—Ä–æ–≤
            document.getElementById('red-slider').value = 1.0;
            document.getElementById('green-slider').value = 1.0;
            document.getElementById('blue-slider').value = 1.0;

            updateSliderValues();

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É
            loadInitialHistogram(imageName);
        }

        function selectWatermarkType(type) {
            selectedWatermarkType = type;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –æ–ø—Ü–∏–∏
            document.querySelectorAll('.watermark-option').forEach(option => {
                option.classList.remove('active');
            });
            document.querySelectorAll('.watermark-controls').forEach(controls => {
                controls.classList.remove('active');
            });

            if (type === 'text') {
                document.querySelectorAll('.watermark-option')[0].classList.add('active');
                document.getElementById('text-watermark-controls').classList.add('active');
            } else {
                document.querySelectorAll('.watermark-option')[1].classList.add('active');
                document.getElementById('image-watermark-controls').classList.add('active');
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –µ—Å–ª–∏ –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ –≤–∫–ª—é—á–µ–Ω
            if (document.getElementById('watermark-toggle').checked) {
                updatePreview();
            }
        }

        function selectWatermarkImage(imageName, imageUrl) {
            selectedWatermarkImage = imageName;
            document.getElementById('selected-watermark-image').value = imageName;

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            document.querySelectorAll('.watermark-image-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.watermark-image-selector').forEach(item => {
                if (item.querySelector('img').src.includes(imageName)) {
                    item.classList.add('active');
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –µ—Å–ª–∏ –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ –≤–∫–ª—é—á–µ–Ω
            if (document.getElementById('watermark-toggle').checked && selectedWatermarkType === 'image') {
                updatePreview();
            }
        }

        function switchTab(tabName) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            if (tabName === 'editor') {
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                document.getElementById('editor-tab').classList.add('active');
            } else {
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                document.getElementById('results-tab').classList.add('active');
            }
        }

        function updateSliderValues() {
            document.getElementById('red-value').textContent =
                parseFloat(document.getElementById('red-slider').value).toFixed(1);
            document.getElementById('green-value').textContent =
                parseFloat(document.getElementById('green-slider').value).toFixed(1);
            document.getElementById('blue-value').textContent =
                parseFloat(document.getElementById('blue-slider').value).toFixed(1);
        }

        async function loadInitialHistogram(imageName) {
            try {
                const response = await fetch(`/get-histogram?image_name=${encodeURIComponent(imageName)}`);
                const result = await response.json();

                if (result.success) {
                    document.getElementById('preview-histogram').src = result.histogram;
                    document.getElementById('preview-histogram').style.display = 'block';
                    document.getElementById('histogram-placeholder').style.display = 'none';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã:', error);
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–æ–≤
        document.getElementById('red-slider').addEventListener('input', updateSliderValues);
        document.getElementById('green-slider').addEventListener('input', updateSliderValues);
        document.getElementById('blue-slider').addEventListener('input', updateSliderValues);

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–æ–≤
        let previewTimeout;
        const updatePreviewDelayed = () => {
            clearTimeout(previewTimeout);
            previewTimeout = setTimeout(updatePreview, 300);
        };

        document.getElementById('red-slider').addEventListener('input', updatePreviewDelayed);
        document.getElementById('green-slider').addEventListener('input', updatePreviewDelayed);
        document.getElementById('blue-slider').addEventListener('input', updatePreviewDelayed);
        document.getElementById('watermark-text').addEventListener('input', updatePreviewDelayed);
        document.getElementById('watermark-toggle').addEventListener('change', updatePreviewDelayed);

        async function updatePreview() {
            if (!selectedImage) return;

            const rFactor = document.getElementById('red-slider').value;
            const gFactor = document.getElementById('green-slider').value;
            const bFactor = document.getElementById('blue-slider').value;
            const watermarkEnabled = document.getElementById('watermark-toggle').checked;

            // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
            let endpoint = '/adjust-preview';
            let formData = new FormData();
            formData.append('image_name', selectedImage);
            formData.append('r_factor', rFactor);
            formData.append('g_factor', gFactor);
            formData.append('b_factor', bFactor);

            if (watermarkEnabled) {
                endpoint = '/watermark-preview';
                formData.append('watermark_type', selectedWatermarkType);
                formData.append('opacity', 0.5); // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å

                if (selectedWatermarkType === 'text') {
                    formData.append('watermark_text', document.getElementById('watermark-text').value);
                } else if (selectedWatermarkType === 'image' && selectedWatermarkImage) {
                    formData.append('watermark_image', selectedWatermarkImage);
                } else {
                    // –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                    endpoint = '/adjust-preview';
                }
            }

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                    document.getElementById('preview-image').src = result.preview_image;

                    // –û–±–Ω–æ–≤–ª—è–µ–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å –≤ –æ—Ç–≤–µ—Ç–µ
                    if (result.preview_histogram) {
                        document.getElementById('preview-histogram').src = result.preview_histogram;
                        document.getElementById('preview-histogram').style.display = 'block';
                        document.getElementById('histogram-placeholder').style.display = 'none';
                    }

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    updateStatsDisplay(result.stats, rFactor, gFactor, bFactor);
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞: ' + result.message, 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞', 'error');
            }
        }

        function updateStatsDisplay(stats, rFactor, gFactor, bFactor) {
            const statsContent = document.getElementById('stats-content');
            const statsContainer = document.getElementById('stats-preview');

            if (!stats || !stats.red) {
                statsContainer.style.display = 'none';
                return;
            }

            statsContainer.style.display = 'block';

            let html = '<div class="stats-grid">';

            const channels = [
                { key: 'red', name: '–ö—Ä–∞—Å–Ω—ã–π', color: '#e74c3c', factor: rFactor },
                { key: 'green', name: '–ó–µ–ª–µ–Ω—ã–π', color: '#2ecc71', factor: gFactor },
                { key: 'blue', name: '–°–∏–Ω–∏–π', color: '#3498db', factor: bFactor }
            ];

            channels.forEach(channel => {
                const channelStats = stats[channel.key];
                html += `
                    <div class="stat-item" style="border-left: 4px solid ${channel.color}">
                        <div class="stat-label">${channel.name} (√ó${parseFloat(channel.factor).toFixed(1)})</div>
                        <div class="stat-value">${Math.round(channelStats.mean)}</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å</div>
                        <div style="font-size: 12px; margin-top: 5px;">
                            min: ${Math.round(channelStats.min)} | max: ${Math.round(channelStats.max)}
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            statsContent.innerHTML = html;
        }

        async function saveModified() {
            if (!selectedImage) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'warning');
                return;
            }

            const rFactor = document.getElementById('red-slider').value;
            const gFactor = document.getElementById('green-slider').value;
            const bFactor = document.getElementById('blue-slider').value;

            const formData = new FormData();
            formData.append('image_name', selectedImage);
            formData.append('r_factor', rFactor);
            formData.append('g_factor', gFactor);
            formData.append('b_factor', bFactor);

            try {
                showNotification('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...', 'info');

                const response = await fetch('/adjust-colors', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!', 'success');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + result.message, 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
            }
        }

        async function saveWithWatermark() {
            if (!selectedImage) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'warning');
                return;
            }

            const rFactor = document.getElementById('red-slider').value;
            const gFactor = document.getElementById('green-slider').value;
            const bFactor = document.getElementById('blue-slider').value;
            const watermarkEnabled = document.getElementById('watermark-toggle').checked;

            if (!watermarkEnabled) {
                showNotification('–í–∫–ª—é—á–∏—Ç–µ –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º', 'warning');
                return;
            }

            const formData = new FormData();
            formData.append('image_name', selectedImage);
            formData.append('r_factor', rFactor);
            formData.append('g_factor', gFactor);
            formData.append('b_factor', bFactor);
            formData.append('watermark_type', selectedWatermarkType);
            formData.append('opacity', 0.5);

            if (selectedWatermarkType === 'text') {
                formData.append('watermark_text', document.getElementById('watermark-text').value);
            } else if (selectedWatermarkType === 'image') {
                if (!selectedWatermarkImage) {
                    showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞', 'warning');
                    return;
                }
                formData.append('watermark_image', selectedWatermarkImage);
            }

            try {
                showNotification('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º...', 'info');

                const response = await fetch('/add-watermark', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!', 'success');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + result.message, 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
            }
        }

        function showNotification(message, type = 'info') {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                animation: fadeIn 0.3s ease-out;
            `;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            switch(type) {
                case 'success':
                    notification.style.background = 'linear-gradient(135deg, #2ecc71, #27ae60)';
                    break;
                case 'error':
                    notification.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
                    break;
                case 'warning':
                    notification.style.background = 'linear-gradient(135deg, #f39c12, #e67e22)';
                    break;
                default:
                    notification.style.background = 'linear-gradient(135deg, #3498db, #2980b9)';
            }

            notification.textContent = message;
            document.body.appendChild(notification);

            // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.style.animation = 'fadeIn 0.3s ease-out reverse';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ fadeIn
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(-20px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `;
            document.head.appendChild(style);

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–∞–π–¥–µ—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            updateSliderValues();

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
            document.getElementById('watermark-toggle').addEventListener('change', function() {
                const controls = document.getElementById('watermark-controls');
                controls.style.display = this.checked ? 'block' : 'none';
                updatePreview();
            });

            // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
            const watermarkImages = document.querySelectorAll('.watermark-image-selector');
            if (watermarkImages.length > 0) {
                const firstImage = watermarkImages[0];
                const img = firstImage.querySelector('img');
                selectWatermarkImage(
                    img.alt,
                    img.src.split('/').pop()
                );
            }
        });
    </script>
</body>
</html>